#!/bin/bash
#SBATCH --job-name=r4_evals
#SBATCH --account=ub62
#SBATCH --gres=gpu:V100:1
#SBATCH --partition=m3g
#SBATCH --ntasks=1
#SBATCH --time=48:00:00
#SBATCH --mem-per-cpu=32768

module load cuda
export SC_LZH=/projects/ub62/imcaption/self-critical.pytorch
python tools/eval.py --input_json ../retina_wp/retina4_talk.json \
	--image_root ../retina_wp/selected \
	--input_label_h5 ../retina_wp/retina4_label.h5 \
	--num_images -1 --model logs/r4_fc/model-best.pth \
	--infos_path logs/r4_fc/infos_fc-best.pkl \
	--language_eval 1 --max_length 60 2>&1 | tee m3/r4_eval_fc.txt

python tools/eval.py --input_json ../retina_wp/retina4_talk.json \
	--image_root ../retina_wp/selected \
	--input_label_h5 ../retina_wp/retina4_label.h5 \
	--num_images -1 --model logs/r4_aoa/model-best.pth \
	--infos_path logs/r4_aoa/infos_aoa-best.pkl \
	--language_eval 1 --max_length 60 2>&1 | tee m3/r4_eval_aoa.txt

python tools/eval.py --input_json ../retina_wp/retina3_talk.json \
	--image_root ../retina_wp/selected \
	--input_label_h5 ../retina_wp/retina3_label.h5 \
	--num_images -1 --model logs/r4_tfv2/model-best.pth \
	--infos_path logs/r4_tfv2/infos_tf-best.pkl \
	--language_eval --max_length 60 1 2>&1 | tee m3/r4_eval_tfv2.txt

python tools/eval.py --input_json ../retina_wp/retina3_talk.json \
	--image_root ../retina_wp/selected \
	--input_label_h5 ../retina_wp/retina3_label.h5 \
	--num_images -1 --model logs/r4_a2i2v2/model-best.pth \
	--infos_path logs/r4_a2i2v2/infos_a2i2-best.pkl \
	--language_eval 1 --max_length 60 2>&1 | tee m3/r4_eval_a2i2v2.txt
